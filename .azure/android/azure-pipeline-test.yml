name: GrampsView Android
  
variables:
  - name: appBase
    value: 'GrampsView'
   
  - name: appxPackageDir
    value: '$(build.artifactStagingDirectory)\AppxPackages\\'

  - name: buildConfiguration
    value: 'Release'
 
  - name: outputDirectory
    value: '$(build.binariesDirectory)\$(BuildConfiguration)'

  - name: projects
    value: '$(Build.SourcesDirectory)/GrampsView.Droid/*.csproj'

  - name: solution
    value: '**/*.sln'

- group: android-pipeline

resources:
  repositories: 
  - repository: shared 
    name: Shared/Shared
    type: git


trigger: none
pr: none
 
pool:
  name: Azure Pipelines
  vmImage: 'windows-latest'
  demands:
  - MSBuild

schedules:
  - cron: "0 0 * * MON,WED,FRI,SUN"
    displayName: Four day a week build
    branches:
        include:
        - main

steps: 
- checkout: self
  submodules: true

- task: NuGetCommand@2
  displayName: 'NuGet restore'
  inputs:
    restoreSolution: '$(solution)'
    feedsToUse: config
    nugetConfigPath: GrampsView/NuGet.Config

- task: DownloadSecureFile@1
  displayName: 'Download secure file: Secret.cs'
  inputs:
    secureFile: 'Secret.cs'

- task: CopyFiles@2
  displayName: 'Copy Files to: GrampsView/Common/'
  inputs:
    SourceFolder: '$(Agent.TempDirectory)'
    Contents: Secret.cs
    TargetFolder: GrampsView/Common/

#- task: DotNetCoreCLI@2
#  inputs:
#    command: 'build'
#    projects: '**/GrampsViewUnitTest.csproj'

- task: DotNetCoreCLI@2
  inputs:
    command: 'test'
    projects: '**/GrampsViewUnitTest.csproj'
    testRunTitle: 'GrampsView'

