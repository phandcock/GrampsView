# GrampsView build NUnit

parameters:
  - name: yesNo # name of the parameter; required
    type: boolean # data type of the parameter; required
    default: false

steps: 
- task: NuGetCommand@2
  displayName: 'NuGet restore solution'
  inputs:
    restoreSolution: '$(solution)'

- task: DownloadSecureFile@1
  displayName: 'Download Secret.cs file'
  inputs:
    secureFile: 'Secret.cs'

- task: CopyFiles@2
  displayName: 'Copy Files to: GrampsView/Common/'
  inputs:
    SourceFolder: '$(Agent.TempDirectory)'
    Contents: Secret.cs
    TargetFolder: GrampsView/Common/

- task: XplatGenerateReleaseNotes@3
  inputs:
    outputfile: '$(Build.ArtifactStagingDirectory)\CHANGELOG.md'
    templateLocation: 'File'
    templatefile: 'GrampsView/AnythingElse/DeploymentTools/ReleaseNotesTemplate.txt'
    dumpPayloadToConsole: true
    dumpPayloadToFile: false
    replaceFile: True
    getParentsAndChildren: False

- task: ExtractVersionFromTag@1
  inputs:
    projectFolderPath: '$(Build.SourcesDirectory)'


- task: VSBuild@1
  displayName: 'Build UWP project'
  inputs:
    solution: '$(projects)'
    msbuildArgs: '/p:AppxBundlePlatforms="$(buildPlatform)"
                  /p:AppxPackageDir="$(appxPackageDir)"
                  /p:AppxBundle=Always
                  /p:UapAppxPackageBuildMode=StoreUpload
                  /p:AppxPackageSigningEnabled=true
                  /p:PackageCertificateThumbprint="$(signingCert.thumbprint)" 
                  /p:PackageCertificateKeyFile="$(signingCert.targetFolder)$(signingCert.SecureFile)"  
                  /p:PackageCertificatePassword="$(signingCert.password)"'
    platform: '$(buildPlatform)'
    configuration: '$(buildConfiguration)'
   
- task: CopyFiles@2 
  displayName: 'Copy Files to: $(Build.ArtifactStagingDirectory)'
  inputs:
    SourceFolder: '$(system.defaultworkingdirectory)'
    Contents: '**\AppxPackages\**'
    TargetFolder: '$(build.artifactstagingdirectory)'
