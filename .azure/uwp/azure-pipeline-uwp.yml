name: GrampsView UWP build

variables:
  - name: appBase
    value: 'GrampsView'

  - name: appxPackageDir
    value: '$(build.artifactStagingDirectory)\AppxPackages\\'

  - name: buildConfiguration
    value: 'Release'

  - name: buildPlatform
    value: 'x64'

  - name: projects
    value: '$(Build.SourcesDirectory)/GrampsView.UWP/*.csproj'

  - name: solution
    value: '**/*.sln'

  - group: uwp-pipeline

resources:
  repositories: 
  - repository: shared 
    name: Shared/Shared
    type: git
    ref: master

trigger:
    tags:
        include:
        - v*

pr: none

jobs:
- job: GrampsView UWP
  timeoutInMinutes: 10 # how long to run the job before automatically cancelling
  cancelTimeoutInMinutes: 2 # how much time to give 'run always even if cancelled tasks' before stopping them

  pool:
    name: Azure Pipelines
    vmImage: 'windows-latest'
    demands:
    - MSBuild
    - Xamarin.Android
    - JDK

  steps:
  - checkout: self
    submodules: true

  - template: /.azure/uwp/azure-pipelinetemplate-build-uwp.yml@shared
    parameters:
      appBase: '$(appBase)'

- task: AppCenterDistribute@3
  displayName: 'Deploy $(build.artifactstagingdirectory)\AppxPackages\*.msixupload to Visual Studio App Center'
  inputs:
    serverEndpoint: 'App Center'
    appSlug: '$(appSlug)'
    appFile: '$(appxPackageDir)\*.msixupload'
    symbolsIncludeParentDirectory: false
    symbolsOption: 'UWP'
    releaseNotesOption: 'file'
    releaseNotesFile: 'CHANGELOG.md'
    isSilent: false
    destinationType: 'groups'
    distributionGroupId: 'f19421ab-bb76-49f6-b4fc-ed1031094c9e'

